<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>足場 原価計算（難易度補正込み）</title>
  <style>
    body { font-family: sans-serif; margin: 2em; max-width: 900px; }
    label { display: block; margin-top: 0.5em; }
    input[type="number"] { width: 100px; font-size: 1em; margin-left: 0.5em; }
    #result, #totalCost, #estimateAmount, #manDays { margin-top: 1em; font-weight: bold; font-size: 1.2em; }
    .checkbox-group, .score-form { margin-top: 2em; }
    fieldset { margin-bottom: 1em;  }
    legend { font-weight: bold;  }
    .footnote { font-size: 0.9em; color: #555; margin-top: 1em; }
    .score-form{ width: 300px; font-size: 1em; margin-left: 0.5em; }
    .additional-options { margin-top: 2em; padding-top: 1em; border-top: 1px solid #ccc; }
    .button-group { margin-top: 1em; }
    button { padding: 0.5em 1em; font-size: 1em; cursor: pointer; }
    
    /* 印刷用スタイル */
    @media print {
      body { font-size: 12pt; }
      button, .no-print { display: none; }
      .print-header { display: block; text-align: center; margin-bottom: 1em; }
      .print-footer { display: block; text-align: center; margin-top: 1em; font-size: 0.8em; }
    }
  </style>
</head>
<body>
  <div class="print-header no-print">
    
   
  </div>

  <h2>足場施工費算出機マコト君１号</h2>

  <label>
    人工単価（円／日）:
    <input type="number" id="laborCost" value="25000" min="0">
  </label>

  <label>
    作業床 面積（㎡）:
    <input type="number" id="area" placeholder="100" min="0">
  </label>

  <label>
    高さ（m）:
    <input type="number" id="height" value="6" min="0">
  </label>

  <div class="checkbox-group">
    <strong>足場の種類（安全対応係数適用）:</strong>
    <label><input type="radio" name="type" value="1.00" checked> くさび式足場（係数 1.00）</label>
    <label><input type="radio" name="type" value="1.15"> 枠組足場（係数 1.15）</label>
    <label><input type="radio" name="type" value="1.30"> 単管足場（係数 1.30）</label>
    <label><input type="radio" name="type" value="1.50"> 吊り足場（係数 1.50）</label>
    <label><input type="radio" name="type" value="0.90"> 移動式足場（係数 0.90）</label>
  </div>

  <div id="result">原価単価: 325.00 円／㎡</div>
  <div id="totalCost">合計金額: 195,000 円</div>

  <div class="additional-options"> 
    <label>
      諸経費率（%）:
      <input type="number" id="overheadRate" value="20" min="0" max="100">
    </label>
    
    <div id="estimateAmount">見積金額（売値）: - 円</div>
    <div id="manDays">必要人工数: - 人日</div>
  </div>

  <div class="score-form">
    <h3>難易度評価</h3>
    <form id="difficultyForm">
      <fieldset>
        <legend>作業高さ</legend>
        <label><input type="radio" name="heightScore" value="1" checked> 地上〜2m</label>
        <label><input type="radio" name="heightScore" value="2"> 2〜5m</label>
        <label><input type="radio" name="heightScore" value="3"> 5〜10m</label>
        <label><input type="radio" name="heightScore" value="4"> 10〜15m</label>
        <label><input type="radio" name="heightScore" value="5"> 15m以上</label>
      </fieldset>

      <fieldset>
        <legend>搬入条件</legend>
        <label><input type="radio" name="transport" value="1" checked> 整地・近距離</label>
        <label><input type="radio" name="transport" value="2"> 小さな段差あり</label>
        <label><input type="radio" name="transport" value="3"> 100m以内手運び</label>
        <label><input type="radio" name="transport" value="4"> 100m超〜300m</label>
        <label><input type="radio" name="transport" value="5"> 300m超〜500m以上</label>
      </fieldset>

      <fieldset>
        <legend>足場支持地</legend>
        <label><input type="radio" name="base" value="1" checked> コンクリ平地</label>
        <label><input type="radio" name="base" value="2"> 軟弱地盤</label>
        <label><input type="radio" name="base" value="3"> 傾斜地</label>
        <label><input type="radio" name="base" value="4"> 配管上</label>
        <label><input type="radio" name="base" value="5"> 不安定</label>
      </fieldset>

      <fieldset>
        <legend>作業姿勢</legend>
        <label><input type="radio" name="posture" value="1" checked> 直立作業</label>
        <label><input type="radio" name="posture" value="2"> かがみ作業</label>
        <label><input type="radio" name="posture" value="3"> 懸垂あり</label>
        <label><input type="radio" name="posture" value="4"> 腰曲げ</label>
        <label><input type="radio" name="posture" value="5"> 狭小・不安定</label>
      </fieldset>

      <fieldset>
        <legend>環境要因</legend>
        <label><input type="radio" name="environment" value="1" checked> 常温・昼間</label>
        <label><input type="radio" name="environment" value="2"> 高温・湿気</label>
        <label><input type="radio" name="environment" value="3"> 夜間作業</label>
        <label><input type="radio" name="environment" value="4"> 有害ガス</label>
        <label><input type="radio" name="environment" value="5"> 爆発対応</label>
      </fieldset>

      <fieldset>
        <legend>干渉物</legend>
        <label><input type="radio" name="interference" value="1" checked> なし</label>
        <label><input type="radio" name="interference" value="2"> 少数配管</label>
        <label><input type="radio" name="interference" value="3"> 密集配管</label>
        <label><input type="radio" name="interference" value="4"> 電気設備多</label>
        <label><input type="radio" name="interference" value="5"> 360度密集</label>
      </fieldset>
    </form>

    <div id="scoreResult">合計スコア: 6 / 難易度補正係数: 1.0</div>
  </div>

  <div class="button-group no-print">
    <button id="printButton">見積書を印刷</button>
    <button id="pdfButton">PDFとして保存</button>
  </div>

  <div class="print-footer no-print">
    ※ 本見積書の有効期限は発行日から30日間です。
  </div>

  <div class="footnote">
    ※ 国土交通省「公共建築工事標準単価積算基準」によれば、くさび式足場の施工量は77㎡／人工とされています。<br>
    <a href="https://www.mlit.go.jp/gobuild/content/001733127.pdf" target="_blank">出典：国交省 積算基準資料</a><br>
    難易度係数は作業環境6項目を元に評価。総スコアに応じて最大2.0倍まで加算されます。
  </div>

  <script>
    const laborCostInput = document.getElementById('laborCost');
    const areaInput = document.getElementById('area');
    const heightInput = document.getElementById('height');
    const typeRadios = document.getElementsByName('type');
    const overheadRateInput = document.getElementById('overheadRate');
    const form = document.getElementById('difficultyForm');
    const resultDiv = document.getElementById('result');
    const totalCostDiv = document.getElementById('totalCost');
    const estimateAmountDiv = document.getElementById('estimateAmount');
    const manDaysDiv = document.getElementById('manDays');
    const scoreResultDiv = document.getElementById('scoreResult');
    const printButton = document.getElementById('printButton');
    const pdfButton = document.getElementById('pdfButton');
    const estimateDateSpan = document.getElementById('estimateDate');
    const 施工量 = 77;

    // 日付を設定
    const today = new Date();
    estimateDateSpan.textContent = today.toLocaleDateString('ja-JP');

    function getSafetyFactor() {
      for (const radio of typeRadios) {
        if (radio.checked) return parseFloat(radio.value);
      }
      return 1.00;
    }

    function getDifficultyFactor() {
      const formData = new FormData(form);
      let score = 0;
      for (const value of formData.values()) score += Number(value);

      let factor = 1.0;
      if (score >= 17) factor = 2.0;
      else if (score >= 13) factor = 1.5;
      else if (score >= 9) factor = 1.2;

      scoreResultDiv.innerText = `合計スコア: ${score} / 難易度補正係数: ${factor}`;
      return factor;
    }

    function updateAll() {
      const laborCost = parseFloat(laborCostInput.value);
      const area = parseFloat(areaInput.value);
      const height = parseFloat(heightInput.value);
      const overheadRate = parseFloat(overheadRateInput.value) / 100;
      const safetyFactor = getSafetyFactor();
      const difficultyFactor = getDifficultyFactor();

      if (!isNaN(laborCost) && !isNaN(area) && !isNaN(height)) {
        const unitCost = laborCost / 施工量;
        const adjustedCost = unitCost * safetyFactor;
        const total = adjustedCost * area * height * difficultyFactor;
        const estimateAmount = total * (1 + overheadRate);
        const manDays = (area * height) / 施工量;

        resultDiv.textContent = `原価単価: ${(adjustedCost).toFixed(2)} 円／㎡`;
        totalCostDiv.textContent = `合計金額: ${Math.round(total).toLocaleString()} 円`;
        estimateAmountDiv.textContent = `見積金額（売値）: ${Math.round(estimateAmount).toLocaleString()} 円`;
        manDaysDiv.textContent = `必要人工数: ${Math.ceil(manDays * 10) / 10} 人日`;
      } else {
        resultDiv.textContent = '原価単価: - 円／㎡';
        totalCostDiv.textContent = '合計金額: - 円';
        estimateAmountDiv.textContent = '見積金額（売値）: - 円';
        manDaysDiv.textContent = '必要人工数: - 人日';
      }
    }

    // 印刷機能
    printButton.addEventListener('click', () => {
      window.print();
    });

    // PDF出力機能（簡易版 - 実際にはサーバーサイド処理やライブラリが必要）
    pdfButton.addEventListener('click', () => {
      alert('PDF出力機能は実際の実装ではhtml2pdf.jsなどのライブラリを使用する必要があります。このデモでは印刷機能をご利用ください。');
      // 実際の実装例:
      // html2pdf().from(document.body).save('足場見積書.pdf');
    });

    // イベント設定
    laborCostInput.addEventListener('input', updateAll);
    areaInput.addEventListener('input', updateAll);
    heightInput.addEventListener('input', updateAll);
    overheadRateInput.addEventListener('input', updateAll);
    typeRadios.forEach(r => r.addEventListener('change', updateAll));
    form.addEventListener('change', updateAll);

    updateAll(); // 初期表示
  </script>
</body>
</html>