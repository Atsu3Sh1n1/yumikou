<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>親ページ（質問と結果）</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 2em;
    }
    button {
      padding: 0.5em 1em;
      margin: 0.5em;
      font-size: 1em;
      cursor: pointer;
    }
    #result {
      margin-top: 2em;
      font-weight: bold;
      font-size: 1.2em;
    }
    iframe {
      display: none; /* ユーザーには子ページは表示しない */
    }
  </style>
</head>
<body>

  <!-- 質問表示 -->
  <div id="question"></div>

  <!-- 選択肢ボタン -->
  <div id="choices"></div>

  <!-- 計算結果表示 -->
  <div id="result"></div>

  <!-- 子ページ（iframe）を非表示で読み込む -->
  <iframe id="childFrame" src="child.html"></iframe>

  <script>
    // 質問と選択肢の配列
    const questions = [
      {
        text: "① 配管の種類を選んでください",
        options: ["鉄", "ステンレス", "塩ビ"]
      },
      {
        text: "② サイズを選んでください",
        options: ["~25A", "~300A", "~500A", "それ以上"]
      },
      {
        text: "③ 使用目的を選んでください",
        options: ["給水", "排水", "空調"]
      }
    ];

    const answers = []; // ユーザーが選んだ答えを格納
    let index = 0;      // 現在の質問番号

    // 質問を画面に表示する
    function showQuestion() {
      const q = questions[index];
      document.getElementById("question").textContent = q.text;

      const choices = document.getElementById("choices");
      choices.innerHTML = ""; // 前のボタンをクリア

      // 各選択肢にボタンを生成
      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          answers.push(opt); // 選択肢を記録
          index++;           // 次の質問へ進む

          if (index < questions.length) {
            showQuestion();  // 次の質問を表示
          } else {
            sendToChild();   // 全質問完了 → 子へ送信
          }
        };
        choices.appendChild(btn);
      });
    }

    // 子ページへ選択結果を postMessage で送信する
    function sendToChild() {
      const iframe = document.getElementById("childFrame");
      iframe.contentWindow.postMessage({
        type: "calc",       // イベントタイプ
        answers: answers    // 回答配列
      }, "*");
    }

    // 子ページからメッセージ（結果）を受け取る
    window.addEventListener("message", (event) => {
      if (event.data.type === "result") {
        const total = event.data.total;
        document.getElementById("result").textContent = `合計係数: ${total}`;
      }
    });

    // 最初の質問を表示
    showQuestion();
  </script>
</body>
</html>
