<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>シンプル見積り（係数付き）</title>
  <style>
    /* あなたのスタイルはそのまま */
    html {
      font-size: 4vw;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: white;
      color: black;
      text-align: center;
      overflow: hidden;
      height: 100%;
    }

    body {
      overflow-y: auto;
      /* hiddenからautoに変更 */
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1em;
      /* 余白を追加 */
      box-sizing: border-box;
    }


    #main {
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #question {
      font-weight: bold;
      font-size: 1.5em;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    #buttons {
      margin-top: 1em;
      opacity: 0;
      animation: fadeIn 1s forwards;
      animation-delay: 1s;
      animation-fill-mode: forwards;
    }

    button {
      background: white;
      border: none;
      padding: 0.75em 1.5em;
      font-size: 1em;
      margin: 0.5em;
      cursor: pointer;
      font-weight: normal;
      border-radius: 999px;
      box-shadow: 0 0.4em 1em rgba(0, 0, 0, 0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover {
      transform: translateY(-0.2em);
      box-shadow: 0 0.6em 1.4em rgba(0, 0, 0, 0.2);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(0.5em);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (min-width: 600px) {
      html {
        font-size: 24px;
      }
    }

    .result-card {
      background: #f8f9fa;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 1.5em 2em;
      max-width: 320px;
      margin: 1em auto;
      text-align: left;
      font-size: 1rem;
      color: #333;
      font-weight: 600;
    }

    .result-card h2 {
      margin-top: 0;
      font-weight: 700;
      color: #2c3e50;
      text-align: center;
    }

    .result-item {
      margin: 0.5em 0;
      display: flex;
      justify-content: space-between;
    }

    .result-label {
      color: #555;
      margin-right: 1.2em;
      /* お好みの幅に調整してください */
    }

    .result-value {
      color: #222;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div id="main">
    <p id="question">配管の種類を選んでください</p>
    <div id="buttons"></div>
  </div>

  <!-- 計算用iframeを非表示で読み込み -->
  <iframe id="calcIframe" src="test2.html" style="display:none;"></iframe>

  <script>
    function setViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('resize', setViewportHeight);
    window.addEventListener('orientationchange', setViewportHeight);
    setViewportHeight();

    // 質問と選択肢
    const questions = [
      { key: "material", text: "配管の種類を選んでください", options: ["鉄", "ステンレス",] },
      { key: "size", text: "サイズを選んでください", options: ["15", "20", "25", "32", "40", "50", "65", "80", "100", "125", "150", "200", "250", "300", "350", "400", "450", "500"] },
      { key: "schedule", text: "スケジュールを選んでください", options: ["sgp", "sch20s", "sch40", "sch80"] },
      { key: "length", text: "長さを入力してください", options: null } // 入力式
    ];

    const answers = {};
    let currentQuestion = 0;

    const questionEl = document.getElementById("question");
    const buttonsDiv = document.getElementById("buttons");
    const iframe = document.getElementById("calcIframe");

    function showQuestion() {
      const q = questions[currentQuestion];
      questionEl.textContent = q.text;
      buttonsDiv.innerHTML = "";

      if (q.options) {
        // ボタンで選択
        q.options.forEach(option => {
          const btn = document.createElement("button");
          btn.textContent = option;
          btn.onclick = () => {
            answers[q.key] = option;
            nextQuestion();
          };
          buttonsDiv.appendChild(btn);
        });

      } else {

        // 入力フォーム（長さ）
        const input = document.createElement("input");
        input.type = "number";
        input.min = "1";
        input.inputMode = "numeric";   // 追加
        input.pattern = "[0-9]*";      // 追加
        input.placeholder = "数字を入力してください";
        input.style.fontSize = "1em";
        input.style.padding = "0.5em";
        buttonsDiv.appendChild(input);

        const btn = document.createElement("button");
        btn.textContent = "次へ";
        btn.onclick = () => {
          const val = input.value.trim();
          if (val === "" || isNaN(val) || Number(val) <= 0) {
            alert("正しい長さを入力してください");
            return;
          }
          answers[q.key] = val;
          nextQuestion();
        };
        buttonsDiv.appendChild(btn);
      }
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion();
      } else {
        // すべての回答が揃ったら計算を依頼
        questionEl.textContent = "計算中…";
        buttonsDiv.innerHTML = "";

        // 単価は固定で550円
        const unitPrice = 650;

        // material を英語に変換して iframeへ送る例
        const materialMap = { "鉄": "steel", "ステンレス": "stainless", "塩ビ": "PVC" };

        const postData = {
          size: answers.size,
          length: Number(answers.length),
          unitPrice: unitPrice,
          schedule: answers.schedule,
          material: materialMap[answers.material] || answers.material
        };

        iframe.contentWindow.postMessage({
          action: "calculate",
          params: postData
        }, "*");
      }
    }

    // 子ページ（iframe）からの計算結果受信
    window.addEventListener("message", (e) => {
      if (e.data.action === "calculationResult") {
        if (e.data.result.success) {
          const r = e.data.result;
          questionEl.textContent = "有限会社 弓工";
          buttonsDiv.innerHTML = `
          <div class="result-card">
          <div class="result-item"><span class="result-label">税別: </span><span class="result-value">¥${Number(r.pipeCost).toLocaleString()}円</span></div>
          <div class="result-item"><span class="result-label">重量 : </span><span class="result-value">${r.pipeWeight}kg</span></div>
          <div class="result-item"><span class="result-label">m/単価: </span><span class="result-value">${Number(r.unitPricePerMeter).toLocaleString()}円</span></div>
          <div class="result-item"><span class="result-label">サイズ: </span><span class="result-value">${r.size}A</span></div>
          <div class="result-item"><span class="result-label">材料: </span><span class="result-value">${r.material}</span></div>

          <div class="result-item"><span class="result-label">スケジュール: </span><span class="result-value">${r.schedule}</span></div>
          </div>
      `;
        } else {
          questionEl.textContent = "計算エラー";
          buttonsDiv.textContent = e.data.result.message || "不明なエラー";
        }
      }
    });


    showQuestion();
  </script>
</body>

</html>