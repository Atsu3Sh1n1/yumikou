# Let's now generate a full HTML + JavaScript system that includes:
# - CSV upload
# - Automatic parsing
# - Coefficient logic for size, material, environment, and experience
# - Calculation of adjusted labor based on uploaded estimate data

html_csv_system = """
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>見積CSV自動解析ツール</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f3f3f3;
            padding: 2em;
        }
        h1 {
            text-align: center;
            color: #004a99;
        }
        .container {
            background: #fff;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: auto;
        }
        input[type="file"] {
            margin: 1em 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2em;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 0.6em;
            text-align: center;
        }
        th {
            background-color: #e0f0ff;
        }
        .highlight {
            background-color: #fff8dc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>見積CSV読込＆係数自動計算ツール</h1>
        <input type="file" id="csvFile" accept=".csv" />
        <table id="resultTable" style="display: none;">
            <thead>
                <tr>
                    <th>工事名</th>
                    <th>配管サイズ</th>
                    <th>材質</th>
                    <th>環境</th>
                    <th>職長</th>
                    <th>見積人工</th>
                    <th>係数合計</th>
                    <th>修正人工</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>

    <script>
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const lines = e.target.result.split('\\n');
                const headers = lines[0].split(',');

                const sizeFactor = {
                    "25A": 1.0, "50A": 1.1, "100A": 1.2, "150A": 1.4, "300A": 1.6
                };
                const materialFactor = {
                    "STPG": 1.0, "SUS": 1.3, "チタン": 1.5
                };
                const envFactor = {
                    "地上": 1.0, "高所": 1.2, "狭隘部": 1.3
                };
                const skillFactor = {
                    "ベテラン": 1.0, "新規職長": 1.1
                };

                const body = document.getElementById('resultBody');
                body.innerHTML = '';
                document.getElementById('resultTable').style.display = 'table';

                for (let i = 1; i < lines.length; i++) {
                    const cells = lines[i].split(',');
                    if (cells.length < 6) continue;

                    const [name, size, material, env, skill, estimateRaw] = cells;
                    const estimate = parseFloat(estimateRaw);

                    const kSize = sizeFactor[size.trim()] || 1.0;
                    const kMat = materialFactor[material.trim()] || 1.0;
                    const kEnv = envFactor[env.trim()] || 1.0;
                    const kSkill = skillFactor[skill.trim()] || 1.0;

                    const kTotal = (kSize * kMat * kEnv * kSkill).toFixed(3);
                    const final = (estimate * kSize * kMat * kEnv * kSkill).toFixed(1);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${name}</td>
                        <td>${size}</td>
                        <td>${material}</td>
                        <td>${env}</td>
                        <td>${skill}</td>
                        <td>${estimate}</td>
                        <td class="highlight">${kTotal}</td>
                        <td><strong>${final}</strong></td>
                    `;
                    body.appendChild(row);
                }
            };
            reader.readAsText(file, 'UTF-8');
        });
    </script>
</body>
</html>
"""

# Save it to a downloadable HTML file
file_path = "/mnt/data/estimate_csv_analysis_tool.html"
with open(file_path, "w", encoding="utf-8") as f:
    f.write(html_csv_system)

file_path
