<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Êó•Â†±</title>
    <style>
        input,
        select,
        textarea {
            font-size: 16px;
            /* üëà iOS„ÅÆ„Ç∫„Éº„É†Èò≤Ê≠¢ */
        }

        body {
            font-family: sans-serif;
            padding: 1em;
        }

        h1 {
            text-align: center;
            margin-bottom: 1em;
        }

        body::before {
            content: "";
            position: fixed;
            top: -4%;
            left: -60%;
            width: 180vw;
            height: 180vh;
            background-image: url('yumikou.png');
            background-repeat: repeat;
            background-size: 200px 100px;
            opacity: 0.03;
            transform: rotate(-10deg);
            transform-origin: center;
            z-index: -1;
            pointer-events: none;
            background-attachment: fixed;
        }

        .control-bar {
            display: flex;
            gap: 1em;
            align-items: center;
            margin-bottom: 1em;
            flex-wrap: wrap;
        }

        select,
        button {
            padding: 0.5em;
            font-size: 1em;
        }

        .person-block {
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 2em;
            padding: 1em;
        }

        .person-header {
            font-weight: bold;
            margin-bottom: 0.5em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reports-container {
            overflow-x: auto;
            display: flex;
            gap: 0.5em;
        }

        .day-form {
            padding: 0.5em;
            border-radius: 4px;
            min-width: 160px;
            flex-shrink: 0;
        }

        .day-form h4 {
            margin: 0 0 0.5em 0;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 0.5em;
        }

        .inline {
            display: inline-block;
            width: 48%;
        }

        .name-site-inputs {
            display: flex;
            gap: 1em;
            margin-bottom: 0.5em;
        }

        .delete-btn {
            background: #e55353;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.3em 0.6em;
            cursor: pointer;
        }

        .footer {
            text-align: center;
            font-size: 14px;
            margin-bottom: -10px;
            margin-top: -20px;
            padding: 0.8rem;
        }

        .narrow-input {
            max-width: 140px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 600px) {
            .person-header {
                flex-wrap: wrap;
                gap: 8px;
            }

            .person-header input {
                flex: 1 1 auto;
            }

            .delete-btn {
                flex-shrink: 0;
            }
        }
    </style>
    </style>
</head>

<body>
    <h1>Êó•Â†±</h1>

    <div class="control-bar">
        <label>
            <select id="yearSelect"></select>
        </label>
        <label>
            <select id="monthSelect"></select>
        </label>
        <button id="addPersonBtn">ÔºãËøΩÂä†</button>
    </div><br><br>

    <div class="footer">
        <a href="https://atsu3sh1n1.github.io/yumikou/" target="_blank">Created by YUMIKOU Inc.</a>
    </div>

    <br><br>

    <div id="formContainer"></div>
    <script>
        const yearSelect = document.getElementById('yearSelect');
        const monthSelect = document.getElementById('monthSelect');
        const formContainer = document.getElementById('formContainer');
        const addPersonBtn = document.getElementById('addPersonBtn');

        // ÂàùÊúüË®≠ÂÆöÔºàÁèæÂú®„ÅÆÂπ¥ÊúàÔºâ
        const now = new Date();
        const defaultYear = now.getFullYear();
        const defaultMonth = now.getMonth() + 1;

        for (let y = defaultYear - 2; y <= defaultYear + 2; y++) {
            const opt = document.createElement('option');
            opt.value = y;
            opt.textContent = y;
            if (y === defaultYear) opt.selected = true;
            yearSelect.appendChild(opt);
        }

        for (let m = 1; m <= 12; m++) {
            const opt = document.createElement('option');
            opt.value = m;
            opt.textContent = m;
            if (m === defaultMonth) opt.selected = true;
            monthSelect.appendChild(opt);
        }

        // ‰øùÂ≠ò„Å®Ë™≠„ÅøËæº„Åø
        function saveData(data) {
            localStorage.setItem('nippouData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('nippouData');
            if (saved) return JSON.parse(saved);
            return {
                year: defaultYear,
                month: defaultMonth,
                people: []
            };
        }

        // Êó•‰ªòÊï∞„ÇíÂèñÂæó
        function getDaysInMonth(year, month) {
            return new Date(year, month, 0).getDate();
        }

        // Êó•Â†±1Êó•ÂàÜ„Éï„Ç©„Éº„É†
        function createDayForm(dayIndex, dayData = {}) {
            const div = document.createElement('div');
            div.className = 'day-form';

            const date = `${dayIndex + 1}Êó•`;

            div.innerHTML = `
      <h4>${date}</h4>
      <input type="text" placeholder="‰ΩúÊ•≠ÂÜÖÂÆπ" value="${dayData.work || ''}" class="workInput"><br/>
      <label>ÂºÅÂΩìÔºö
        <select class="bentoSelect">
          <option value="">-</option>
          <option value="‚óã" ${dayData.bento === '‚óã' ? 'selected' : ''}>‚óã</option>
          <option value="„Å™„Åó" ${dayData.bento === '„Å™„Åó' ? 'selected' : ''}>„Å™„Åó</option>
        </select>
      </label><br/>
      <input type="number" min="0" step="0.1" placeholder="ÊÆãÊ•≠(h)" value="${dayData.overtime || ''}" class="overtimeInput">
    `;
            return div;
        }

        // 1‰∫∫ÂàÜ„ÅÆ„Éï„Ç©„Éº„É†‰ΩúÊàê
        function createPersonForm(personIndex, personData, daysCount) {
            const div = document.createElement('div');
            div.className = 'person-block';
            div.dataset.personIndex = personIndex;

            // ÂêçÂâç„ÉªÁèæÂ†¥ÂêçÂÖ•Âäõ
            const header = document.createElement('div');
            header.className = 'person-header';

            const nameInput = document.createElement('input');
            nameInput.placeholder = "Ê∞èÂêç";
            nameInput.value = personData.name || '';
            nameInput.className = 'narrow-input';  // üëà ËøΩÂä†
            nameInput.style.marginRight = '1em';

            const siteInput = document.createElement('input');
            siteInput.placeholder = "ÁèæÂ†¥Âêç";
            siteInput.value = personData.site || '';
            siteInput.className = 'narrow-input';  // üëà ËøΩÂä†

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'ÂâäÈô§';
            deleteBtn.className = 'delete-btn';
            deleteBtn.onclick = () => {
                const data = loadData();
                data.people.splice(personIndex, 1);
                saveData(data);
                refreshPeopleForms();
            };

            header.appendChild(nameInput);
            header.appendChild(siteInput);
            header.appendChild(deleteBtn);
            div.appendChild(header);

            // Êó•Â†±„Ç≥„É≥„ÉÜ„Éä
            const reportsContainer = document.createElement('div');
            reportsContainer.className = 'reports-container';

            for (let i = 0; i < daysCount; i++) {
                const dayData = personData.days?.[i] || {};
                const dayForm = createDayForm(i, dayData);
                reportsContainer.appendChild(dayForm);
            }

            div.appendChild(reportsContainer);

            // ÂÖ•Âäõ„Ç§„Éô„É≥„Éà„Çí‰øùÂ≠ò„Å´ÂèçÊò†
            div.addEventListener('input', () => {
                const data = loadData();
                const thisPerson = data.people[personIndex];
                thisPerson.name = nameInput.value;
                thisPerson.site = siteInput.value;
                thisPerson.days = [];

                const dayForms = div.querySelectorAll('.day-form');
                dayForms.forEach((df, i) => {
                    const work = df.querySelector('.workInput').value;
                    const bento = df.querySelector('.bentoSelect').value;
                    const overtime = df.querySelector('.overtimeInput').value;
                    thisPerson.days[i] = { work, bento, overtime };
                });

                saveData(data);
            });

            return div;
        }

        // ÂÖ®‰ΩìÊèèÁîª
        function refreshPeopleForms() {
            const data = loadData();
            formContainer.innerHTML = '';
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const daysCount = getDaysInMonth(year, month);

            data.year = year;
            data.month = month;

            data.people.forEach((person, index) => {
                const form = createPersonForm(index, person, daysCount);
                formContainer.appendChild(form);
            });

            saveData(data);
        }

        // Âπ¥ÊúàÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        yearSelect.addEventListener('change', refreshPeopleForms);
        monthSelect.addEventListener('change', refreshPeopleForms);

        // ‰∫∫ËøΩÂä†„Éú„Çø„É≥
        addPersonBtn.addEventListener('click', () => {
            const data = loadData();
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const daysCount = getDaysInMonth(year, month);
            const days = Array.from({ length: daysCount }, () => ({ work: "", bento: "", overtime: "" }));
            data.people.push({ name: "", site: "", days });
            saveData(data);
            refreshPeopleForms();
        });

        // ÂàùÊúüË™≠„ÅøËæº„Åø
        const saved = loadData();
        yearSelect.value = saved.year;
        monthSelect.value = saved.month;
        refreshPeopleForms();
    </script>

    <!-- Ë™≠„ÅøËæº„Åø -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        // „ÅÇ„Å™„Åü„ÅÆPublic KeyÔºà„Åæ„Åü„ÅØ userIDÔºâ„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ
        emailjs.init("N0y00sZTW1vteBYpK"); 
    </script>

    <!-- „É°„Éº„É´ÈÄÅ‰ø°„Éú„Çø„É≥ -->
    <button onclick="sendEmail()">„É°„Éº„É´ÈÄÅ‰ø° / ÊúâÈôê‰ºöÁ§æÂºìÂ∑•:‰∫ãÂãô</button><br><br>
    ‚úÖÈÄÅ‰ø°ÂÜÖÂÆπ„Çµ„É≥„Éó„É´ÔºàÈÄÅ„Çâ„Çå„ÇãÊú¨ÊñáÔºâ<br>
<br>
‚ñ† 2025Âπ¥5Êúà Êó•Â†±„Éá„Éº„Çø<br><br>

---- 1. ‰ΩêËó§ / AÁèæÂ†¥ ----<br>
1Êó•: ‰ΩúÊ•≠=ÈâÑÁ≠ãÁµÑ„Åø / ÂºÅÂΩì=‚óã / ÊÆãÊ•≠=1.5h<br>
2Êó•: ‰ΩúÊ•≠=Ë∂≥Â†¥Ë®≠ÁΩÆ / ÂºÅÂΩì=„Å™„Åó / ÊÆãÊ•≠=0.0h<br>
...<br>
<br>
---- 2. Èà¥Êú® / BÁèæÂ†¥ ----<br>
1Êó•: ‰ΩúÊ•≠=Êê¨ÂÖ• / ÂºÅÂΩì=‚óã / ÊÆãÊ•≠=0.5h<br>
...<br><br>
emailjsÁµåÁî±<br>

    

    <script>
       

        function sendEmail() {
            const data = loadData(); // ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÊó•Â†±„Éá„Éº„Çø„ÇíÂèñÂæó
            const year = data.year;
            const month = data.month;

            let message = `‚ñ† ${year}Âπ¥${month}Êúà Âª∫Ë®≠Êó•Â†±\n\n`;

            data.people.forEach((person, i) => {
                const name = person.name || '(Ê∞èÂêçÊú™ÂÖ•Âäõ)';
                const site = person.site || '(ÁèæÂ†¥ÂêçÊú™ÂÖ•Âäõ)';
                message += `---- ${i + 1}. ${site} / ${name} ----\n`;

                person.days.forEach((day, d) => {
                    const work = day.work || '-';
                    const bento = day.bento || '-';
                    const overtime = day.overtime || '0';
                    message += `${d + 1}Êó•: ‰ΩúÊ•≠=${work} / ÂºÅÂΩì=${bento} / ÊÆãÊ•≠=${overtime}h\n`;
                });

                message += '\n';
            });

            const templateParams = {
                subject: `${year}Âπ¥${month}Êúà Âª∫Ë®≠Êó•Â†±`,
                message: message
            };

            emailjs.send("service_w62u2ko", "template_a78gn8x", templateParams)
                .then(() => alert("„É°„Éº„É´ÈÄÅ‰ø°ÊàêÂäüÔºÅ"))
                .catch(err => alert("ÈÄÅ‰ø°Â§±ÊïóÔºö" + JSON.stringify(err)));
        }

    </script>

</body>

</html>