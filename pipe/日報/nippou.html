<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>æ—¥å ±</title>
    <style>
        input,
        select,
        textarea {
            font-size: 16px;
            /* ğŸ‘ˆ iOSã®ã‚ºãƒ¼ãƒ é˜²æ­¢ */
        }

        body {
            font-family: sans-serif;
            padding: 1em;
        }

        h1 {
            text-align: center;
            margin-bottom: 1em;
        }

        body::before {
            content: "";
            position: fixed;
            top: -4%;
            left: -60%;
            width: 180vw;
            height: 180vh;
            background-image: url('yumikou.png');
            background-repeat: repeat;
            background-size: 200px 100px;
            opacity: 0.03;
            transform: rotate(-10deg);
            transform-origin: center;
            z-index: -1;
            pointer-events: none;
            background-attachment: fixed;
        }

        .control-bar {
            display: flex;
            gap: 1em;
            align-items: center;
            margin-bottom: 1em;
            flex-wrap: wrap;
        }

        select,
        button {
            padding: 0.5em;
            font-size: 1em;
        }

        .person-block {
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 2em;
            padding: 1em;
        }

        .person-header {
            font-weight: bold;
            margin-bottom: 0.5em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reports-container {
            overflow-x: auto;
            display: flex;
            gap: 0.5em;
        }

        .day-form {
            padding: 0.5em;
            border-radius: 4px;
            min-width: 160px;
            flex-shrink: 0;
        }

        .day-form h4 {
            margin: 0 0 0.5em 0;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 0.5em;
        }

        .inline {
            display: inline-block;
            width: 48%;
        }

        .name-site-inputs {
            display: flex;
            gap: 1em;
            margin-bottom: 0.5em;
        }

        .delete-btn {
            background: #e55353;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.3em 0.6em;
            cursor: pointer;
        }

        .footer {
            text-align: center;
            font-size: 14px;
            margin-bottom: -10px;
            margin-top: -20px;
            padding: 0.8rem;
        }

        .narrow-input {
            max-width: 140px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 600px) {
            .person-header {
                flex-wrap: wrap;
                gap: 8px;
            }

            .person-header input {
                flex: 1 1 auto;
            }

            .delete-btn {
                flex-shrink: 0;
            }
        }
    </style>
    </style>
</head>

<body>
    <h1>æ—¥å ±</h1>

    <div class="control-bar">
        <label>
            <select id="yearSelect"></select>
        </label>
        <label>
            <select id="monthSelect"></select>
        </label>
        <button id="addPersonBtn">ï¼‹è¿½åŠ </button>
    </div><br><br>

    <div class="footer">
        <a href="https://atsu3sh1n1.github.io/yumikou/" target="_blank">Created by YUMIKOU Inc.</a>
    </div>

    <br><br>

    <div id="formContainer"></div>
    <script>
        const yearSelect = document.getElementById('yearSelect');
        const monthSelect = document.getElementById('monthSelect');
        const formContainer = document.getElementById('formContainer');
        const addPersonBtn = document.getElementById('addPersonBtn');

        // åˆæœŸè¨­å®šï¼ˆç¾åœ¨ã®å¹´æœˆï¼‰
        const now = new Date();
        const defaultYear = now.getFullYear();
        const defaultMonth = now.getMonth() + 1;

        for (let y = defaultYear - 2; y <= defaultYear + 2; y++) {
            const opt = document.createElement('option');
            opt.value = y;
            opt.textContent = y;
            if (y === defaultYear) opt.selected = true;
            yearSelect.appendChild(opt);
        }

        for (let m = 1; m <= 12; m++) {
            const opt = document.createElement('option');
            opt.value = m;
            opt.textContent = m;
            if (m === defaultMonth) opt.selected = true;
            monthSelect.appendChild(opt);
        }

        // ä¿å­˜ã¨èª­ã¿è¾¼ã¿
        function saveData(data) {
            localStorage.setItem('nippouData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('nippouData');
            if (saved) return JSON.parse(saved);
            return {
                year: defaultYear,
                month: defaultMonth,
                people: []
            };
        }

        // æ—¥ä»˜æ•°ã‚’å–å¾—
        function getDaysInMonth(year, month) {
            return new Date(year, month, 0).getDate();
        }

        // æ—¥å ±1æ—¥åˆ†ãƒ•ã‚©ãƒ¼ãƒ 
        function createDayForm(dayIndex, dayData = {}) {
            const div = document.createElement('div');
            div.className = 'day-form';

            const date = `${dayIndex + 1}æ—¥`;

            div.innerHTML = `
      <h4>${date}</h4>
      <input type="text" placeholder="ä½œæ¥­å†…å®¹" value="${dayData.work || ''}" class="workInput"><br/>
      <label>å¼å½“ï¼š
        <select class="bentoSelect">
          <option value="">-</option>
          <option value="â—‹" ${dayData.bento === 'â—‹' ? 'selected' : ''}>â—‹</option>
          <option value="ãªã—" ${dayData.bento === 'ãªã—' ? 'selected' : ''}>ãªã—</option>
        </select>
      </label><br/>
      <input type="number" min="0" step="0.1" placeholder="æ®‹æ¥­(h)" value="${dayData.overtime || ''}" class="overtimeInput">
    `;
            return div;
        }

        // 1äººåˆ†ã®ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
        function createPersonForm(personIndex, personData, daysCount) {
            const div = document.createElement('div');
            div.className = 'person-block';
            div.dataset.personIndex = personIndex;

            // åå‰ãƒ»ç¾å ´åå…¥åŠ›
            const header = document.createElement('div');
            header.className = 'person-header';

            const nameInput = document.createElement('input');
            nameInput.placeholder = "æ°å";
            nameInput.value = personData.name || '';
            nameInput.className = 'narrow-input';  // ğŸ‘ˆ è¿½åŠ 
            nameInput.style.marginRight = '1em';

            const siteInput = document.createElement('input');
            siteInput.placeholder = "ç¾å ´å";
            siteInput.value = personData.site || '';
            siteInput.className = 'narrow-input';  // ğŸ‘ˆ è¿½åŠ 

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'å‰Šé™¤';
            deleteBtn.className = 'delete-btn';
            deleteBtn.onclick = () => {
                const data = loadData();
                data.people.splice(personIndex, 1);
                saveData(data);
                refreshPeopleForms();
            };

            header.appendChild(nameInput);
            header.appendChild(siteInput);
            header.appendChild(deleteBtn);
            div.appendChild(header);

            // æ—¥å ±ã‚³ãƒ³ãƒ†ãƒŠ
            const reportsContainer = document.createElement('div');
            reportsContainer.className = 'reports-container';

            for (let i = 0; i < daysCount; i++) {
                const dayData = personData.days?.[i] || {};
                const dayForm = createDayForm(i, dayData);
                reportsContainer.appendChild(dayForm);
            }

            div.appendChild(reportsContainer);

            // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã«åæ˜ 
            div.addEventListener('input', () => {
                const data = loadData();
                const thisPerson = data.people[personIndex];
                thisPerson.name = nameInput.value;
                thisPerson.site = siteInput.value;
                thisPerson.days = [];

                const dayForms = div.querySelectorAll('.day-form');
                dayForms.forEach((df, i) => {
                    const work = df.querySelector('.workInput').value;
                    const bento = df.querySelector('.bentoSelect').value;
                    const overtime = df.querySelector('.overtimeInput').value;
                    thisPerson.days[i] = { work, bento, overtime };
                });

                saveData(data);
            });

            return div;
        }

        // å…¨ä½“æç”»
        function refreshPeopleForms() {
            const data = loadData();
            formContainer.innerHTML = '';
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const daysCount = getDaysInMonth(year, month);

            data.year = year;
            data.month = month;

            data.people.forEach((person, index) => {
                const form = createPersonForm(index, person, daysCount);
                formContainer.appendChild(form);
            });

            saveData(data);
        }

        // å¹´æœˆå¤‰æ›´æ™‚ã®å‡¦ç†
        yearSelect.addEventListener('change', refreshPeopleForms);
        monthSelect.addEventListener('change', refreshPeopleForms);

        // äººè¿½åŠ ãƒœã‚¿ãƒ³
        addPersonBtn.addEventListener('click', () => {
            const data = loadData();
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const daysCount = getDaysInMonth(year, month);
            const days = Array.from({ length: daysCount }, () => ({ work: "", bento: "", overtime: "" }));
            data.people.push({ name: "", site: "", days });
            saveData(data);
            refreshPeopleForms();
        });

        // åˆæœŸèª­ã¿è¾¼ã¿
        const saved = loadData();
        yearSelect.value = saved.year;
        monthSelect.value = saved.month;
        refreshPeopleForms();
    </script>

    <!-- èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        // ã‚ãªãŸã®Public Keyï¼ˆã¾ãŸã¯ userIDï¼‰ã«ç½®ãæ›ãˆã¦ãã ã•ã„
        emailjs.init("N0y00sZTW1vteBYpK"); 
    </script>

    <!-- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button onclick="sendEmail()">ãƒ¡ãƒ¼ãƒ«é€ä¿¡ / æœ‰é™ä¼šç¤¾å¼“å·¥:äº‹å‹™</button><br><br>
    âœ…é€ä¿¡å†…å®¹ã‚µãƒ³ãƒ—ãƒ«ï¼ˆé€ã‚‰ã‚Œã‚‹æœ¬æ–‡ï¼‰<br>
<br>
â–  2025å¹´5æœˆ æ—¥å ±ãƒ‡ãƒ¼ã‚¿<br><br>

---- 1. ä½è—¤ / Aç¾å ´ ----<br>
1æ—¥: ä½œæ¥­=é‰„ç­‹çµ„ã¿ / å¼å½“=â—‹ / æ®‹æ¥­=1.5h<br>
2æ—¥: ä½œæ¥­=è¶³å ´è¨­ç½® / å¼å½“=ãªã— / æ®‹æ¥­=0.0h<br>
...<br>
<br>
---- 2. éˆ´æœ¨ / Bç¾å ´ ----<br>
1æ—¥: ä½œæ¥­=æ¬å…¥ / å¼å½“=â—‹ / æ®‹æ¥­=0.5h<br>
...<br><br>
emailjsçµŒç”±<br>

    

    <script>
       

        function sendEmail() {
            const data = loadData(); // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const year = data.year;
            const month = data.month;

            let message = `â–  ${year}å¹´${month}æœˆ å»ºè¨­æ—¥å ±\n\n`;

            data.people.forEach((person, i) => {
                const name = person.name || '(æ°åæœªå…¥åŠ›)';
                const site = person.site || '(ç¾å ´åæœªå…¥åŠ›)';
                message += `---- ${i + 1}. ${site} / ${name} ----\n`;

                person.days.forEach((day, d) => {
                    const work = day.work || '-';
                    const bento = day.bento || '-';
                    const overtime = day.overtime || '0';
                    message += `${d + 1}æ—¥: ä½œæ¥­=${work} / å¼å½“=${bento} / æ®‹æ¥­=${overtime}h\n`;
                });

                message += '\n';
            });

            const templateParams = {
                subject: `${year}å¹´${month}æœˆ å»ºè¨­æ—¥å ±`,
                message: message
            };

            emailjs.send("service_w62u2ko", "template_a78gn8x", templateParams)
                .then(() => alert("ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸï¼"))
                .catch(err => alert("é€ä¿¡å¤±æ•—ï¼š" + JSON.stringify(err)));
        }

    </script>

</body>

</html>